import{nextTick as e,reactive as t,defineComponent as n,ref as r,computed as i,onMounted as o,onUnmounted as a,createVNode as s,watch as u}from"vue";function l(e,t){return e(t={exports:{}},t.exports),t.exports}var d=l((function(e){var t=Object.prototype.toString,n=Object.prototype.propertyIsEnumerable,r=Object.getOwnPropertySymbols;function i(e){return"function"==typeof e||"[object Object]"===t.call(e)||Array.isArray(e)}e.exports=function(e){for(var t=arguments.length,o=Array(t>1?t-1:0),a=1;a<t;a++)o[a-1]=arguments[a];if(!i(e))throw new TypeError("expected the first argument to be an object");if(0===o.length||"function"!=typeof Symbol||"function"!=typeof r)return e;var s=!0,u=!1,l=void 0;try{for(var d,c=o[Symbol.iterator]();!(s=(d=c.next()).done);s=!0){var h=d.value,f=r(h),v=!0,p=!1,A=void 0;try{for(var g,y=f[Symbol.iterator]();!(v=(g=y.next()).done);v=!0){var b=g.value;n.call(h,b)&&(e[b]=h[b])}}catch(e){p=!0,A=e}finally{try{!v&&y.return&&y.return()}finally{if(p)throw A}}}}catch(e){u=!0,l=e}finally{try{!s&&c.return&&c.return()}finally{if(u)throw l}}return e}})),c=Object.freeze({__proto__:null,default:d,__moduleExports:d}),h=c&&d||c,f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),A=l((function(e){var t=Object.prototype.toString,n=function(e){return"__proto__"!==e&&"constructor"!==e&&"prototype"!==e},r=e.exports=function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),s=1;s<t;s++)a[s-1]=arguments[s];var u=0;for(o(e)&&(e=a[u++]),e||(e={});u<a.length;u++)if(i(a[u])){var l=!0,d=!1,c=void 0;try{for(var f,v=Object.keys(a[u])[Symbol.iterator]();!(l=(f=v.next()).done);l=!0){var p=f.value;n(p)&&(i(e[p])&&i(a[u][p])?r(e[p],a[u][p]):e[p]=a[u][p])}}catch(e){d=!0,c=e}finally{try{!l&&v.return&&v.return()}finally{if(d)throw c}}h(e,a[u])}return e};function i(e){return"function"==typeof e||"[object Object]"===t.call(e)}function o(e){return"object"===(void 0===e?"undefined":f(e))?null===e:"function"!=typeof e}})),g="undefined"!=typeof window&&null!==window,y=function(){if(g&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)return"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}}),!0;return!1}();var b="event",m="observer";function w(e,t){if(e.length){var n=e.indexOf(t);return n>-1?e.splice(n,1):void 0}}function _(e,t){if("IMG"!==e.tagName||!e.getAttribute("data-srcset"))return"";var n=e.getAttribute("data-srcset").trim().split(","),r=[],i=e.parentNode.offsetWidth*t,o=void 0,a=void 0,s=void 0;n.forEach((function(e){e=e.trim(),-1===(o=e.lastIndexOf(" "))?(a=e,s=99999):(a=e.substr(0,o),s=parseInt(e.substr(o+1,e.length-o-2),10)),r.push([s,a])})),r.sort((function(e,t){if(e[0]<t[0])return 1;if(e[0]>t[0])return-1;if(e[0]===t[0]){if(-1!==t[1].indexOf(".webp",t[1].length-5))return 1;if(-1!==e[1].indexOf(".webp",e[1].length-5))return-1}return 0}));for(var u="",l=void 0,d=0;d<r.length;d++){u=(l=r[d])[1];var c=r[d+1];if(c&&c[0]<i){u=l[1];break}if(!c){u=l[1];break}}return u}var L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return g&&window.devicePixelRatio||e};function E(){if(!g)return!1;var e=!0;function t(e,t){var n=new Image;n.onload=function(){var e=n.width>0&&n.height>0;t(e)},n.onerror=function(){t(!1)},n.src="data:image/webp;base64,"+{lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"}[e]}return t("lossy",(function(t){e=t})),t("lossless",(function(t){e=t})),t("alpha",(function(t){e=t})),t("animation",(function(t){e=t})),e}var k=function(){if(!g)return!1;var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",T,t)}catch(e){}return e}(),Q={on:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];k?e.addEventListener(t,n,{capture:r,passive:!0}):e.addEventListener(t,n,r)},off:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.removeEventListener(t,n,r)}},I=function(e,t,n){var r=new Image;if(!e||!e.src){var i=new Error("image src is required");return n(i)}e.cors&&(r.crossOrigin=e.cors),r.src=e.src,r.onload=function(){t({naturalHeight:r.naturalHeight,naturalWidth:r.naturalWidth,src:r.src}),r=null},r.onerror=function(e){n(e)}},z=function(e,t){return"undefined"!=typeof getComputedStyle?getComputedStyle(e,null).getPropertyValue(t):e.style[t]},O=function(e){return z(e,"overflow")+z(e,"overflowY")+z(e,"overflowX")};function T(){}var x=function(){function e(t){v(this,e),this.max=t||100,this._caches=[]}return p(e,[{key:"has",value:function(e){return this._caches.indexOf(e)>-1}},{key:"add",value:function(e){this.has(e)||(this._caches.push(e),this._caches.length>this.max&&this.free())}},{key:"free",value:function(){this._caches.shift()}}]),e}(),S=function(){function e(t,n,r,i,o,a,s,u,l,d){v(this,e),this.el=t,this.src=n,this.error=r,this.loading=i,this.bindType=o,this.attempt=0,this.cors=u,this.naturalHeight=0,this.naturalWidth=0,this.options=s,this.rect={},this.$parent=a,this.elRenderer=l,this._imageCache=d,this.performanceData={init:Date.now(),loadStart:0,loadEnd:0},this.filter(),this.initState(),this.render("loading",!1)}return p(e,[{key:"initState",value:function(){"dataset"in this.el?this.el.dataset.src=this.src:this.el.setAttribute("data-src",this.src),this.state={loading:!1,error:!1,loaded:!1,rendered:!1}}},{key:"record",value:function(e){this.performanceData[e]=Date.now()}},{key:"update",value:function(e){var t=this.src;this.src=e.src,this.loading=e.loading,this.error=e.error,this.filter(),t!==this.src&&(this.attempt=0,this.initState())}},{key:"getRect",value:function(){this.rect=this.el.getBoundingClientRect()}},{key:"checkInView",value:function(){return this.getRect(),this.rect.top<window.innerHeight*this.options.preLoad&&this.rect.bottom>this.options.preLoadTop&&this.rect.left<window.innerWidth*this.options.preLoad&&this.rect.right>0}},{key:"filter",value:function(){for(var e in this.options.filter)this.options.filter[e](this,this.options)}},{key:"renderLoading",value:function(e){var t=this;this.state.loading=!0,I({src:this.loading,cors:this.cors},(function(){t.render("loading",!1),t.state.loading=!1,e()}),(function(){e(),t.state.loading=!1,t.options.silent||console.warn("VueLazyload log: load failed with loading image("+t.loading+")")}))}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T;return this.attempt>this.options.attempt-1&&this.state.error?(this.options.silent||console.log("VueLazyload log: "+this.src+" tried too more than "+this.options.attempt+" times"),void t()):this.state.rendered&&this.state.loaded?void 0:this._imageCache.has(this.src)?(this.state.loaded=!0,this.render("loaded",!0),this.state.rendered=!0,t()):void this.renderLoading((function(){e.attempt++,e.options.adapter.beforeLoad&&e.options.adapter.beforeLoad(e,e.options),e.record("loadStart"),I({src:e.src,cors:e.cors},(function(n){e.naturalHeight=n.naturalHeight,e.naturalWidth=n.naturalWidth,e.state.loaded=!0,e.state.error=!1,e.record("loadEnd"),e.render("loaded",!1),e.state.rendered=!0,e._imageCache.add(e.src),t()}),(function(t){!e.options.silent&&console.error(t),e.state.error=!0,e.state.loaded=!1,e.render("error",!1)}))}))}},{key:"render",value:function(e,t){this.elRenderer(this,e,t)}},{key:"performance",value:function(){var e="loading",t=0;return this.state.loaded&&(e="loaded",t=(this.performanceData.loadEnd-this.performanceData.loadStart)/1e3),this.state.error&&(e="error"),{src:this.src,state:e,time:t}}},{key:"$destroy",value:function(){this.el=null,this.src="",this.error=null,this.loading="",this.bindType=null,this.attempt=0}}]),e}(),R="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",B=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],C={rootMargin:"0px",threshold:0},H=function(){function t(e){var n,r,i,o,a=e.preLoad,s=e.error,u=e.throttleWait,l=e.preLoadTop,d=e.dispatchEvent,c=e.loading,h=e.attempt,f=e.silent,p=void 0===f||f,A=e.scale,g=e.listenEvents,y=e.filter,w=e.adapter,_=e.observer,k=e.observerOptions;v(this,t),this.version="__VUE_LAZYLOAD_NEXT_VERSION__",this.lazyContainerMananger=null,this.mode=b,this.ListenerQueue=[],this.TargetIndex=0,this.TargetQueue=[],this.options={silent:p,dispatchEvent:!!d,throttleWait:u||200,preLoad:a||1.3,preLoadTop:l||0,error:s||R,loading:c||R,attempt:h||3,scale:A||L(A),listenEvents:g||B,supportWebp:E(),filter:y||{},adapter:w||{},observer:!!_,observerOptions:k||C},this._initEvent(),this._imageCache=new x(200),this.lazyLoadHandler=(n=this._lazyLoadHandler.bind(this),r=this.options.throttleWait,i=null,o=0,function(){if(!i){var e=Date.now()-o,t=this,a=arguments,s=function(){o=Date.now(),i=!1,n.apply(t,a)};e>=r?s():i=setTimeout(s,r)}}),this.setMode(this.options.observer?m:b)}return p(t,[{key:"config",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A(this.options,e)}},{key:"performance",value:function(){var e=[];return this.ListenerQueue.map((function(t){return e.push(t.performance())})),e}},{key:"addLazyBox",value:function(e){this.ListenerQueue.push(e),g&&(this._addListenerTarget(window),this._observer&&this._observer.observe(e.el),e.$el&&e.$el.parentNode&&this._addListenerTarget(e.$el.parentNode))}},{key:"add",value:function(t,n,r){var i=this;if(this.ListenerQueue.some((function(e){return e.el===t})))return this.update(t,n),e(this.lazyLoadHandler);var o=this._valueFormatter(n.value),a=o.src,s=o.loading,u=o.error,l=o.cors;e((function(){a=_(t,i.options.scale)||a,i._observer&&i._observer.observe(t);var r=Object.keys(n.modifiers)[0],o=void 0;r&&(o=(o=n.instance.$refs[r])?o.el||o:document.getElementById(r)),o||(o=function(e){if(g){if(!(e instanceof Element))return window;for(var t=e;t&&t!==document.body&&t!==document.documentElement&&t.parentNode;){if(/(scroll|auto)/.test(O(t)))return t;t=t.parentNode}return window}}(t));var d=new S(t,a,u,s,n.arg,o,i.options,l,i._elRenderer.bind(i),i._imageCache);i.ListenerQueue.push(d),g&&(i._addListenerTarget(window),i._addListenerTarget(o)),e((function(){return i.lazyLoadHandler()}))}))}},{key:"update",value:function(t,n,r){var i=this,o=this._valueFormatter(n.value),a=o.src,s=o.loading,u=o.error;a=_(t,this.options.scale)||a;var l=this.ListenerQueue.find((function(e){return e.el===t}));l?l.update({src:a,loading:s,error:u}):this.add(t,n,r),this._observer&&(this._observer.unobserve(t),this._observer.observe(t)),e((function(){return i.lazyLoadHandler()}))}},{key:"remove",value:function(e){if(e){this._observer&&this._observer.unobserve(e);var t=this.ListenerQueue.find((function(t){return t.el===e}));t&&(this._removeListenerTarget(t.$parent),this._removeListenerTarget(window),w(this.ListenerQueue,t),t.$destroy&&t.$destroy())}}},{key:"removeComponent",value:function(e){e&&(w(this.ListenerQueue,e),this._observer&&this._observer.unobserve(e.el),e.$parent&&e.$el.parentNode&&this._removeListenerTarget(e.$el.parentNode),this._removeListenerTarget(window))}},{key:"setMode",value:function(e){var t=this;y||e!==m||(e=b),this.mode=e,e===b?(this._observer&&(this.ListenerQueue.forEach((function(e){t._observer.unobserve(e.el)})),this._observer=null),this.TargetQueue.forEach((function(e){t._initListen(e.el,!0)}))):(this.TargetQueue.forEach((function(e){t._initListen(e.el,!1)})),this._initIntersectionObserver())}},{key:"_addListenerTarget",value:function(e){if(e){var t=this.TargetQueue.find((function(t){return t.el===e}));return t?t.childrenCount++:(t={el:e,id:++this.TargetIndex,childrenCount:1,listened:!0},this.mode===b&&this._initListen(t.el,!0),this.TargetQueue.push(t)),this.TargetIndex}}},{key:"_removeListenerTarget",value:function(e){var t=this;this.TargetQueue.forEach((function(n,r){n.el===e&&(n.childrenCount--,n.childrenCount||(t._initListen(n.el,!1),t.TargetQueue.splice(r,1),n=null))}))}},{key:"_initListen",value:function(e,t){var n=this;this.options.listenEvents.forEach((function(r){return Q[t?"on":"off"](e,r,n.lazyLoadHandler)}))}},{key:"_initEvent",value:function(){var e=this;this.Event={listeners:{loading:[],loaded:[],error:[]}},this.$on=function(t,n){e.Event.listeners[t]||(e.Event.listeners[t]=[]),e.Event.listeners[t].push(n)},this.$once=function(t,n){var r=e;e.$on(t,(function e(){r.$off(t,e),n.apply(r,arguments)}))},this.$off=function(t,n){if(n)w(e.Event.listeners[t],n);else{if(!e.Event.listeners[t])return;e.Event.listeners[t].length=0}},this.$emit=function(t,n,r){e.Event.listeners[t]&&e.Event.listeners[t].forEach((function(e){return e(n,r)}))}}},{key:"_lazyLoadHandler",value:function(){var e=this,t=[];this.ListenerQueue.forEach((function(e,n){e.el&&e.el.parentNode&&!e.state.loaded||t.push(e),e.checkInView()&&(e.state.loaded||e.load())})),t.forEach((function(t){w(e.ListenerQueue,t),t.$destroy&&t.$destroy()}))}},{key:"_initIntersectionObserver",value:function(){var e=this;y&&(this._observer=new IntersectionObserver(this._observerHandler.bind(this),this.options.observerOptions),this.ListenerQueue.length&&this.ListenerQueue.forEach((function(t){e._observer.observe(t.el)})))}},{key:"_observerHandler",value:function(e){var t=this;e.forEach((function(e){e.isIntersecting&&t.ListenerQueue.forEach((function(n){if(n.el===e.target){if(n.state.loaded)return t._observer.unobserve(n.el);n.load()}}))}))}},{key:"_elRenderer",value:function(e,t,n){if(e.el){var r=e.el,i=e.bindType,o=void 0;switch(t){case"loading":o=e.loading;break;case"error":o=e.error;break;default:o=e.src}if(i?r.style[i]='url("'+o+'")':r.getAttribute("src")!==o&&r.setAttribute("src",o),r.setAttribute("lazy",t),this.$emit(t,e,n),this.options.adapter[t]&&this.options.adapter[t](e,this.options),this.options.dispatchEvent){var a=new CustomEvent(t,{detail:e});r.dispatchEvent(a)}}}},{key:"_valueFormatter",value:function(e){var t,n=e,r=this.options.loading,i=this.options.error,o=this.options.cors;return null!==(t=e)&&"object"===(void 0===t?"undefined":f(t))&&(e.src||this.options.silent||console.error("Vue Lazyload Next warning: miss src with "+e),n=e.src,r=e.loading||this.options.loading,i=e.error||this.options.error),{src:n,loading:r,error:i,cors:o}}}]),t}(),$=function(e,n){var r=t({});return{rect:r,checkInView:function(){return r=e.value.getBoundingClientRect(),g&&r.top<window.innerHeight*n&&r.bottom>0&&r.left<window.innerWidth*n&&r.right>0}}},V=function(e){return n({props:{tag:{type:String,default:"div"}},emits:["show"],setup:function(n,u){var l=u.emit,d=u.slots,c=r(null),h=t({loaded:!1,error:!1,attempt:0}),f=r(!1),v=$(c,e.options.preLoad),p=v.rect,A=v.checkInView,g=function(){f.value=!0,h.loaded=!0,l("show",f.value)},y=i((function(){return{el:c.value,rect:p,checkInView:A,load:g,state:h}}));return o((function(){e.addLazyBox(y.value),e.lazyLoadHandler()})),a((function(){e.removeComponent(y.value)})),function(){var e;return s(n.tag,{ref:c},[f.value&&(null===(e=d.default)||void 0===e?void 0:e.call(d))])}}})},j=function(){function e(t){v(this,e),this.lazy=t,t.lazyContainerMananger=this,this._queue=[]}return p(e,[{key:"bind",value:function(e,t,n){var r=new W(e,t,n,this.lazy);this._queue.push(r)}},{key:"update",value:function(e,t,n){var r=this._queue.find((function(t){return t.el===e}));r&&r.update(e,t)}},{key:"unbind",value:function(e,t,n){var r=this._queue.find((function(t){return t.el===e}));r&&(r.clear(),w(this._queue,r))}}]),e}(),D={selector:"img",error:"",loading:""},W=function(){function e(t,n,r,i){v(this,e),this.el=t,this.vnode=r,this.binding=n,this.options={},this.lazy=i,this._queue=[],this.update(t,n)}return p(e,[{key:"update",value:function(e,t){var n=this;this.el=e,this.options=A({},D,t.value),this.getImgs().forEach((function(e){n.lazy.add(e,A({},n.binding,{value:{src:e.getAttribute("data-src")||e.dataset.src,error:e.getAttribute("data-error")||e.dataset.error||n.options.error,loading:e.getAttribute("data-loading")||e.dataset.loading||n.options.loading}}),n.vnode)}))}},{key:"getImgs",value:function(){return Array.from(this.el.querySelectorAll(this.options.selector))}},{key:"clear",value:function(){var e=this;this.getImgs().forEach((function(t){return e.lazy.remove(t)})),this.vnode=null,this.binding=null,this.lazy=null}}]),e}(),U=function(e){return n({props:{src:[String,Object],tag:{type:String,default:"img"}},setup:function(n,l){var d=l.slots,c=r(null),h=t({src:"",error:"",loading:"",attempt:e.options.attempt}),f=t({loaded:!1,error:!1,attempt:0}),v=$(c,e.options.preLoad),p=v.rect,A=v.checkInView,g=r(""),y=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T;if(f.attempt>h.attempt-1&&f.error)return e.options.silent||console.log("VueLazyload log: "+h.src+" tried too more than "+h.attempt+" times"),void t();var n=h.src;I({src:n},(function(e){var t=e.src;g.value=t,f.loaded=!0}),(function(){f.attempt++,g.value=h.error,f.error=!0}))},b=i((function(){return{el:c.value,rect:p,checkInView:A,load:y,state:f}}));o((function(){e.addLazyBox(b.value),e.lazyLoadHandler()})),a((function(){e.removeComponent(b.value)}));var m=function(){var t=e._valueFormatter(n.src),r=t.src,i=t.loading,o=t.error;f.loaded=!1,h.src=r,h.error=o,h.loading=i,g.value=h.loading};return u((function(){return n.src}),(function(){m(),e.addLazyBox(b.value),e.lazyLoadHandler()})),m(),function(){var e;return s(n.tag,{src:g.value,ref:c},[null===(e=d.default)||void 0===e?void 0:e.call(d)])}}})},N={install:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new H(t),r=new j(n),i=Number(e.version.split(".")[0]);if(i<3)return new Error("Vue version at least 3.0");e.config.globalProperties.$Lazyload=n,t.lazyComponent&&e.component("lazy-component",V(n)),t.lazyImage&&e.component("lazy-image",U(n)),e.directive("lazy",{beforeMount:n.add.bind(n),beforeUpdate:n.update.bind(n),updated:n.lazyLoadHandler.bind(n),unmounted:n.remove.bind(n)}),e.directive("lazy-container",{beforeMount:r.bind.bind(r),updated:r.update.bind(r),unmounted:r.unbind.bind(r)})}};export default N;
